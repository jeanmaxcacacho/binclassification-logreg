<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jean Maximus C. Cacacho">

<title>Supervised Classification of Diabetes Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap-428660f2d989aa45215d191e3ad83543.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Supervised Classification of Diabetes Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jean Maximus C. Cacacho </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The data used to perform this <em>report(?)</em> was obtained from an open-access Kaggle data repository. Accessing this data can be done through the link below:</p>
<p>https://www.kaggle.com/datasets/iammustafatz/diabetes-prediction-dataset</p>
<p>The primary objective of this study is to perform a <strong>binary classification task with logistic regression</strong>, identifying diabetic from non-diabetic observations. Second to this would be examining the effect of two different resampling approaches: <strong>(i) undersampling</strong> and <strong>(ii) oversampling</strong>, to the performance of the model.</p>
</section>
<section id="data-pre-processing" class="level1">
<h1>Data Pre-processing</h1>
<p>To yield a performant model, it’s imperative for our input data to be clean. This involves pruning observations from the original data file, scaling values, and the appropriate value conversions, among other appropriate steps that may arise.</p>
<p>On a high level, what is done in this subsection of the <em>notebook(?)</em> are the following:</p>
<ol type="1">
<li>Loading the dataset into R studio.</li>
<li>Summary statistics informing data cleanup process.</li>
<li>Data cleanup.</li>
</ol>
<section id="loading-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-data">Loading Data</h2>
<p>In this step the <code>diabetes_prediction_dataset.csv</code> file is stored into a dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>raw_df <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"../data/diabetes_prediction_dataset.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After this, the head and tail of the loaded dataframe was inspected to see if the file was read into the environment.</p>
<section id="head" class="level3">
<h3 class="anchored" data-anchor-id="head">Head</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   gender   age hypertension heart_disease smoking_history   bmi HbA1c_level
   &lt;char&gt; &lt;num&gt;        &lt;int&gt;         &lt;int&gt;          &lt;char&gt; &lt;num&gt;       &lt;num&gt;
1: Female    80            0             1           never 25.19         6.6
2: Female    54            0             0         No Info 27.32         6.6
3:   Male    28            0             0           never 27.32         5.7
4: Female    36            0             0         current 23.45         5.0
5:   Male    76            1             1         current 20.14         4.8
6: Female    20            0             0           never 27.32         6.6
   blood_glucose_level diabetes
                 &lt;int&gt;    &lt;int&gt;
1:                 140        0
2:                  80        0
3:                 158        0
4:                 155        0
5:                 155        0
6:                  85        0</code></pre>
</div>
</div>
</section>
<section id="tail" class="level3">
<h3 class="anchored" data-anchor-id="tail">Tail</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   gender   age hypertension heart_disease smoking_history   bmi HbA1c_level
   &lt;char&gt; &lt;num&gt;        &lt;int&gt;         &lt;int&gt;          &lt;char&gt; &lt;num&gt;       &lt;num&gt;
1: Female    36            0             0         No Info 24.60         4.8
2: Female    80            0             0         No Info 27.32         6.2
3: Female     2            0             0         No Info 17.37         6.5
4:   Male    66            0             0          former 27.83         5.7
5: Female    24            0             0           never 35.42         4.0
6: Female    57            0             0         current 22.43         6.6
   blood_glucose_level diabetes
                 &lt;int&gt;    &lt;int&gt;
1:                 145        0
2:                  90        0
3:                 100        0
4:                 155        0
5:                 100        0
6:                  90        0</code></pre>
</div>
</div>
</section>
</section>
<section id="removing-nulls" class="level2">
<h2 class="anchored" data-anchor-id="removing-nulls">Removing Nulls</h2>
<p>Before further pre-processing steps (scaling, value conversion etc.), observations that aren’t <em>complete</em> will be removed. Essentially rows with missing data are to be discarded from the considered dataset.</p>
<section id="counting-nulls-attribute" class="level3">
<h3 class="anchored" data-anchor-id="counting-nulls-attribute">Counting Nulls / Attribute</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gender"              "age"                 "hypertension"       
[4] "heart_disease"       "smoking_history"     "bmi"                
[7] "HbA1c_level"         "blood_glucose_level" "diabetes"           </code></pre>
</div>
</div>
<p>From this cell it can be gathered that there are 9 attributes all in all. From the whole dataset with respect to each of these attributes, we count the amount of nulls.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>null_counts <span class="ot">&lt;-</span> raw_df[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x) <span class="sc">|</span> <span class="fu">trimws</span>(x) <span class="sc">==</span> <span class="st">""</span>))]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(null_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   gender   age hypertension heart_disease smoking_history   bmi HbA1c_level
    &lt;int&gt; &lt;int&gt;        &lt;int&gt;         &lt;int&gt;           &lt;int&gt; &lt;int&gt;       &lt;int&gt;
1:      0     0            0             0               0     0           0
   blood_glucose_level diabetes
                 &lt;int&gt;    &lt;int&gt;
1:                   0        0</code></pre>
</div>
</div>
<p>The result of the previous cell shows that all rows have complete data.</p>
</section>
</section>
<section id="value-conversions" class="level2">
<h2 class="anchored" data-anchor-id="value-conversions">Value Conversions</h2>
<p>Part of data pre-processing is also ensuring that observations are stored in programmatically convenient formats. In the context of R an example of this would be storing categorical/discrete data as <code>factor</code>s.</p>
<p><code>str(raw_df)</code> can be used to inspect how these values are stored in the dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  100000 obs. of  9 variables:
 $ gender             : chr  "Female" "Female" "Male" "Female" ...
 $ age                : num  80 54 28 36 76 20 44 79 42 32 ...
 $ hypertension       : int  0 0 0 0 1 0 0 0 0 0 ...
 $ heart_disease      : int  1 0 0 0 1 0 0 0 0 0 ...
 $ smoking_history    : chr  "never" "No Info" "never" "current" ...
 $ bmi                : num  25.2 27.3 27.3 23.4 20.1 ...
 $ HbA1c_level        : num  6.6 6.6 5.7 5 4.8 6.6 6.5 5.7 4.8 5 ...
 $ blood_glucose_level: int  140 80 158 155 155 85 200 85 145 100 ...
 $ diabetes           : int  0 0 0 0 0 0 1 0 0 0 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>The previous query showed that the following attributes: (i) gender, (ii) hypertension, (iii) heart_disease, (iv) smoking_history, and (v) diabetes, are categorical. However, the attribute smoking_history seems to have more than just 2 possible values.</p>
<p>To be sure, an inspection of all unique values in these attributes ascertains whether or not the value is binary or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>categorical_attr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"hypertension"</span>, <span class="st">"heart_disease"</span>, <span class="st">"smoking_history"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>unique_vals <span class="ot">&lt;-</span> <span class="fu">lapply</span>(raw_df[, ..categorical_attr], unique)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_vals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$gender
[1] "Female" "Male"   "Other" 

$hypertension
[1] 0 1

$heart_disease
[1] 1 0

$smoking_history
[1] "never"       "No Info"     "current"     "former"      "ever"       
[6] "not current"

$diabetes
[1] 0 1</code></pre>
</div>
</div>
<p>It can be seen that the attributes: hypertension, heart_disease, and diabetes, already only have two possible values; gender and smoking_history however do not.</p>
<section id="handling-gender-attribute" class="level3">
<h3 class="anchored" data-anchor-id="handling-gender-attribute">Handling <code>gender</code> Attribute</h3>
<p><em>Surface level research</em> shows that individuals with non-binary gender identities show higher incidence rates for other diabetes related comorbidities, e.g.&nbsp;smoking <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC8529476/#:~:text=Transgender%20and%20gender%2Dexpansive%20(TGE)%20adults%E2%80%94individuals%20who%20have,to%20smoke%20cigarettes%20than%20cisgender%20individuals%20%5B3%5D.">(Tan et. al.&nbsp;2021)</a>. This suggests that gender identities beyond just male and female may provide the model with sufficient information, along with other features, for classification.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 56%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>gender</th>
<th>description</th>
<th style="text-align: right;">encoding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Male</td>
<td>Individual whose sex is Male</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>Female</td>
<td>Individual whose sex is Female</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td>Other</td>
<td>Individual with non-binary gender identity</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<p>These encodings serve only to be labels that are programmatically convenient to work with in processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gender_encodings <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Male"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Female"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Other"</span> <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>raw_df[, gender_code <span class="sc">:</span><span class="er">=</span> gender_encodings[gender]]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        gender   age hypertension heart_disease smoking_history   bmi
        &lt;char&gt; &lt;num&gt;        &lt;int&gt;         &lt;int&gt;          &lt;char&gt; &lt;num&gt;
     1: Female    80            0             1           never 25.19
     2: Female    54            0             0         No Info 27.32
     3:   Male    28            0             0           never 27.32
     4: Female    36            0             0         current 23.45
     5:   Male    76            1             1         current 20.14
    ---                                                              
 99996: Female    80            0             0         No Info 27.32
 99997: Female     2            0             0         No Info 17.37
 99998:   Male    66            0             0          former 27.83
 99999: Female    24            0             0           never 35.42
100000: Female    57            0             0         current 22.43
        HbA1c_level blood_glucose_level diabetes gender_code
              &lt;num&gt;               &lt;int&gt;    &lt;int&gt;       &lt;num&gt;
     1:         6.6                 140        0           1
     2:         6.6                  80        0           1
     3:         5.7                 158        0           0
     4:         5.0                 155        0           1
     5:         4.8                 155        0           0
    ---                                                     
 99996:         6.2                  90        0           1
 99997:         6.5                 100        0           1
 99998:         5.7                 155        0           0
 99999:         4.0                 100        0           1
100000:         6.6                  90        0           1</code></pre>
</div>
</div>
<p>It can be seen that <code>gender</code> has been successfully encoded into <code>gender_code</code>. As such, the original column can now be discarded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>raw_df[, gender <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          age hypertension heart_disease smoking_history   bmi HbA1c_level
        &lt;num&gt;        &lt;int&gt;         &lt;int&gt;          &lt;char&gt; &lt;num&gt;       &lt;num&gt;
     1:    80            0             1           never 25.19         6.6
     2:    54            0             0         No Info 27.32         6.6
     3:    28            0             0           never 27.32         5.7
     4:    36            0             0         current 23.45         5.0
     5:    76            1             1         current 20.14         4.8
    ---                                                                   
 99996:    80            0             0         No Info 27.32         6.2
 99997:     2            0             0         No Info 17.37         6.5
 99998:    66            0             0          former 27.83         5.7
 99999:    24            0             0           never 35.42         4.0
100000:    57            0             0         current 22.43         6.6
        blood_glucose_level diabetes gender_code
                      &lt;int&gt;    &lt;int&gt;       &lt;num&gt;
     1:                 140        0           1
     2:                  80        0           1
     3:                 158        0           0
     4:                 155        0           1
     5:                 155        0           0
    ---                                         
 99996:                  90        0           1
 99997:                 100        0           1
 99998:                 155        0           0
 99999:                 100        0           1
100000:                  90        0           1</code></pre>
</div>
</div>
</section>
<section id="handling-smoking_history-attribute" class="level3">
<h3 class="anchored" data-anchor-id="handling-smoking_history-attribute">Handling <code>smoking_history</code> Attribute</h3>
<p>The earlier cell that was supposed to detect and count for null values was not able to catch <code>smoking_history</code> observations marked with <code>No Info</code>. That was because the previous function looked for values stored in R as <code>NA</code> or as empty strings. Including these observations may just be <em>noise</em> for the classifier, as such observations with <code>No Info</code> in <code>smoking_history</code> are discarded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>row_count_before <span class="ot">&lt;-</span> raw_df[, .N] <span class="co"># row count before drop</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Row count before drop: "</span>, row_count_before))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Row count before drop:  100000"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>raw_df <span class="ot">&lt;-</span> raw_df[<span class="sc">!</span>(smoking_history <span class="sc">==</span> <span class="st">"No Info"</span>)]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(raw_df<span class="sc">$</span>smoking_history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "never"       "current"     "former"      "ever"        "not current"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>row_count_after <span class="ot">&lt;-</span> raw_df[, .N] <span class="co"># row count after drop</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Row count after drop: "</span>, row_count_after))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Row count after drop:  64184"</code></pre>
</div>
</div>
<p>To turn the remaining string values into meaningful numerical data, <strong>ordinal encoding comes to mind.</strong> Notice how the magnitude of <code>smoking_history</code> can be surmised from the current values; those who have never smoked have, by definition, smoked less than those who were former smokers. Through the same intuition, it can be said that current smokers smoke the most. Formal definitions for these terms can be obtained from <a href="https://www.cdc.gov/mmwr/volumes/72/wr/mm7210a7.htm">online medical sources</a>.</p>
<p>From this information these encodings were generated:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 56%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>smoking_history</th>
<th>description</th>
<th style="text-align: right;">encoding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>never</td>
<td>never smoked before, or has smoked less than 100 cigarettes in their lifetime</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>former</td>
<td>smoked at least 100 cigarettes in their lifetime but does not currently smoke</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td>not current</td>
<td>smoked at least 100 cigarettes in their lifetime but does not currently smoke</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td>ever</td>
<td>term encompassing both current and former smokers, anyone who has smoked at least 100 cigarettes in their lifetime</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td>current</td>
<td>smoked at least 100 cigarettes in their lifetime and currently smokes</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
<p>It must be noted that in the context of this project, the terms <code>former</code>, <code>ever</code>, and <code>not current</code>, were not defined in the data card. As such, operative definitions were gleaned from the CDC <em>QuickStats</em> article hyperlinked above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>smoking_encodings <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"never"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"former"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"not current"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ever"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"current"</span> <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>raw_df[, smoking_code <span class="sc">:</span><span class="er">=</span> smoking_encodings[smoking_history]]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         age hypertension heart_disease smoking_history   bmi HbA1c_level
       &lt;num&gt;        &lt;int&gt;         &lt;int&gt;          &lt;char&gt; &lt;num&gt;       &lt;num&gt;
    1:    80            0             1           never 25.19         6.6
    2:    28            0             0           never 27.32         5.7
    3:    36            0             0         current 23.45         5.0
    4:    76            1             1         current 20.14         4.8
    5:    20            0             0           never 27.32         6.6
   ---                                                                   
64180:    26            0             0           never 34.34         6.5
64181:    40            0             0           never 40.69         3.5
64182:    66            0             0          former 27.83         5.7
64183:    24            0             0           never 35.42         4.0
64184:    57            0             0         current 22.43         6.6
       blood_glucose_level diabetes gender_code smoking_code
                     &lt;int&gt;    &lt;int&gt;       &lt;num&gt;        &lt;num&gt;
    1:                 140        0           1            0
    2:                 158        0           0            0
    3:                 155        0           1            2
    4:                 155        0           0            2
    5:                  85        0           1            0
   ---                                                      
64180:                 160        0           1            0
64181:                 155        0           1            0
64182:                 155        0           0            1
64183:                 100        0           1            0
64184:                  90        0           1            2</code></pre>
</div>
</div>
<p>It can be seen that <code>smoking_history</code> has been encoded successfully into the column smoking_code; the old column can now be safely discarded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>raw_df[, smoking_history <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         age hypertension heart_disease   bmi HbA1c_level blood_glucose_level
       &lt;num&gt;        &lt;int&gt;         &lt;int&gt; &lt;num&gt;       &lt;num&gt;               &lt;int&gt;
    1:    80            0             1 25.19         6.6                 140
    2:    28            0             0 27.32         5.7                 158
    3:    36            0             0 23.45         5.0                 155
    4:    76            1             1 20.14         4.8                 155
    5:    20            0             0 27.32         6.6                  85
   ---                                                                       
64180:    26            0             0 34.34         6.5                 160
64181:    40            0             0 40.69         3.5                 155
64182:    66            0             0 27.83         5.7                 155
64183:    24            0             0 35.42         4.0                 100
64184:    57            0             0 22.43         6.6                  90
       diabetes gender_code smoking_code
          &lt;int&gt;       &lt;num&gt;        &lt;num&gt;
    1:        0           1            0
    2:        0           0            0
    3:        0           1            2
    4:        0           0            2
    5:        0           1            0
   ---                                  
64180:        0           1            0
64181:        0           1            0
64182:        0           0            1
64183:        0           1            0
64184:        0           1            2</code></pre>
</div>
</div>
<p>Now that the data is clean, categorical columns can now be converted to the <code>factor</code> data type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>categorical_attr2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender_code"</span>, <span class="st">"hypertension"</span>, <span class="st">"heart_disease"</span>, <span class="st">"smoking_code"</span>, <span class="st">"diabetes"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>raw_df[, (categorical_attr2) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, as.factor), .SDcols <span class="ot">=</span> categorical_attr2]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># verify changes</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(raw_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  64184 obs. of  9 variables:
 $ age                : num  80 28 36 76 20 44 42 32 53 54 ...
 $ hypertension       : Factor w/ 2 levels "0","1": 1 1 1 2 1 1 1 1 1 1 ...
 $ heart_disease      : Factor w/ 2 levels "0","1": 2 1 1 2 1 1 1 1 1 1 ...
 $ bmi                : num  25.2 27.3 23.4 20.1 27.3 ...
 $ HbA1c_level        : num  6.6 5.7 5 4.8 6.6 6.5 4.8 5 6.1 6 ...
 $ blood_glucose_level: int  140 158 155 155 85 200 145 100 85 100 ...
 $ diabetes           : Factor w/ 2 levels "0","1": 1 1 1 1 1 2 1 1 1 1 ...
 $ gender_code        : Factor w/ 3 levels "0","1","2": 2 1 2 1 2 2 1 2 2 2 ...
 $ smoking_code       : Factor w/ 3 levels "0","1","2": 1 1 3 3 1 1 1 1 1 2 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<p>The goal in exploratory data analysis is discovering correlations and distributions in both dependent and independent variables. This is important as it informs the way model performance metrics are to be interpreted, if there are any fine-tuning methods to apply amongst other things.</p>
<section id="class-imbalances" class="level2">
<h2 class="anchored" data-anchor-id="class-imbalances">Class Imbalances</h2>
<p>One of the biggest hurdles in classification tasks is class imbalance in the data; when there are more observations for a certain dependent variable than others then there is a class imbalance. In the context of the project the dependent variable is the <code>diabetes</code> attribute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>class_imbalance_data <span class="ot">&lt;-</span> raw_df[, .(diabetes)]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> class_imbalance_data[, .N, by<span class="ot">=</span>diabetes]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(diabetes), <span class="at">y =</span> N)) <span class="sc">+</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">fill=</span><span class="st">"steelblue"</span>) <span class="sc">+</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Target Variable Distribution"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Diabetes (0 = Non-diabetic, 1 = Diabetic)"</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Observations"</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="report_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>